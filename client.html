<html>
  <head>
    <title>AJAX Client</title>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
    <script type="text/javascript" src="http://static.stackmob.com/js/stackmob-js-0.9.2-bundled-min.js"></script>
    <script type="text/javascript" src="stackmob-proxy.js"></script>
    <script type="text/javascript">
      StackMob.init({
        publicKey : 'b4670ece-8d14-4859-a149-690f4ce62bba',

        //setting this will kick the JS SDK into postMessage proxy call mode (thanks to stackmob-proxy.js)
        proxyURL : 'http://dev.proxyexperiment.tai.stackmobapp.com/proxy.html',
        apiVersion : 0
      });

    </script>
  </head>
  <body>
    <h1>Cross Domain AJAX calls with
    <code>
      window.postMessage
    </code></h1>
    <p>
      Check the console for test results.
<pre><code>
var users = new StackMob.Users();
var q = new StackMob.Collection.Query();
users.query(q, { 
	success: function(x) { 
		console.debug(x.toJSON()); 
	}, 
	error: function(fail, message) { 
		console.debug(message); 
	}
});	
</code></pre>
    </p>
    <p></p>
    <script type="text/javascript" charset="utf-8">
      $(document).ready(function() {//wait for the iframe tag to load
        $('#proxy').load(function() {//wait for the contents of the iframe to load
          //now you're ready to start making cross domain calls

          var users = new StackMob.Users();
          var q = new StackMob.Collection.Query();
          users.query(q, {
            success : function(model, response, options) {
              console.debug(model.toJSON());
            },
            error : function(model, response, options) {
              console.debug(response);
            }
          });
        });
      });

    </script>
  </body>
</html>
